angular.module("chinavis",["ngAnimate","ui.router"]).factory("localStorage",["$window",function(e){return{set:function(t,a){e.localStorage[t]=a},get:function(t){return e.localStorage[t]||""},setObject:function(t,a){e.localStorage[t]=JSON.stringify(a)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")}}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("situation",{url:"/",templateUrl:"./Situation/situation.html",controller:"situationController"}).state("analysis",{url:"/analysis",templateUrl:"./Analysis/analysis.html",controller:"analysisController"}),t.otherwise("/")}]),angular.module("chinavis").service("visService",["$http","$q",function(e,t){return{getData:function(a,o){var n=t.defer();return e({method:"GET",url:a,params:o}).then(function(e){e.status=!0,n.resolve(e.data)},function(e){e.status=!1,n.reject(e)}),n.promise}}}]),angular.module("chinavis").constant("colorMap",[{name:"小姐上门",color:"#17becf"},{name:"代开发票",color:"#1f77b4"},{name:"赌博麻将",color:"#ff7f0e"},{name:"办证刻章",color:"#2ca02c"},{name:"银行诈骗",color:"#d62728"},{name:"苹果诈骗",color:"#9467bd"},{name:"房地产广告",color:"#8c564b"},{name:"贷款服务",color:"#e377c2"},{name:"各类广告",color:"#bcbd22"},{name:"招聘信息",color:"#17becf"},{name:"诽谤谣言",color:"#5878cf"},{name:"中国移动",color:"#74b0a1"},{name:"收驾驶证",color:"#b09355"}]),angular.module("chinavis").controller("situationController",["$scope","localStorage","colorMap","visService","$interval","$filter",function(e,t,a,o,n,i){e.colorMap=a,e.types=["所有分类"],e.colorMap.map(function(t){e.types.push(t.name)}),e.selectedType=e.types[0],e.viewTime="",e.currentTime="2017-02-23 00:00:00",t.set("startTime",new Date(e.currentTime).valueOf()/1e3),e.timeRange="",e.show=!1,e.close=function(){e.show=!1},e.records=[];var r=new AMap.Map("container",{mapStyle:"amap://styles/grey",zoom:11,center:[116.366576,39.921797]});r.setFeatures(["road","bg"]),AMapUI.load(["ui/misc/PointSimplifier","lib/utils","lib/$"],function(l,s,c){function m(e,t){m.__super__.constructor.apply(this,arguments)}if(!l.supportCanvas)return void alert("当前环境不支持 Canvas！");s.inherit(m,l.Render.Canvas),s.extend(m.prototype,{renderNormalPoints:function(e,t,a){m.__super__.renderNormalPoints.call(this,e,null,a);for(var o=this.getOption("pointStyle"),n=this.getOption("getPointsGroupKey"),i=this.getOption("pointStyleGroup"),r=this.getPointSimplifierInstance(),l={},c=0,p=t.length;c<p;c++){var u=t[c],y=u.idx,d=r.getDataItemByIndex(y),f=n.call(this,d,y);l[f]||(l[f]=[]),l[f].push(t[c])}for(var g in l){var h=s.extend({},o,i[g]);this.drawPointsWithStyleOptions(l[g],h)}}});var p=new l({map:r,getPosition:function(e){return e?[parseFloat(e.lng),parseFloat(e.lat)]:null},getHoverTitle:function(e){return e.content},autoSetFitView:!1,renderConstructor:m,renderOptions:{pointStyle:{width:5,height:5,fillStyle:"#d939bd"},hoverTitleStyle:{position:"top"},getPointsGroupKey:function(e){return"g"+e.type},pointStyleGroup:{g0:{fillStyle:a[0].color},g1:{fillStyle:a[1].color},g2:{fillStyle:a[2].color},g3:{fillStyle:a[3].color},g4:{fillStyle:a[4].color},g5:{fillStyle:a[5].color},g6:{fillStyle:a[6].color},g7:{fillStyle:a[7].color},g8:{fillStyle:a[8].color},g9:{fillStyle:a[9].color},g10:{fillStyle:a[10].color},g11:{fillStyle:a[11].color},g12:{fillStyle:a[12].color}}}});p.on("pointClick",function(e,t){console.log(e.type,t.data.recitime)});var u=echarts.init(document.getElementById("legendType"));u.setOption({grid:{left:5,right:30,top:10,bottom:0,containLabel:!0},xAxis:{show:!1},yAxis:{type:"category",boundaryGap:!1,axisLabel:{textStyle:{color:function(){return a[0].color}}},data:a.map(function(e){return e.name})},series:[{type:"bar",barMaxWidth:20,itemStyle:{normal:{color:function(e){return a[e.dataIndex].color}}},label:{normal:{show:!0,position:"right"}},data:[]}]});var y=echarts.init(document.getElementById("legendPhone"));y.setOption({tooltip:{trigger:"item",formatter:"{c} ({d}%)"},series:[{type:"pie",radius:"55%",center:["50%","60%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});var d=echarts.init(document.getElementById("area-stack"));e.areas=[],d.setOption({tooltip:{trigger:"axis",axisPointer:{animation:!1}},grid:{left:0,right:35,bottom:5,containLabel:!0},dataZoom:[{show:!1,realtime:!0,start:0,end:100},{type:"inside"}],xAxis:{type:"category",boundaryGap:!1,nameLocation:"middle",axisLine:{lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}},data:e.areas.map(function(e){return e.time})},yAxis:{show:!1},series:[{name:"num",type:"line",lineStyle:{normal:{width:1}},areaStyle:{normal:{color:"#aaaaaa"}},symbolSize:3,label:{normal:{show:!0,position:"top"}},data:e.areas.map(function(e){return e.num})}]}),y.on("click",function(t){if("series"===t.componentType&&"pie"===t.seriesType){var t={startTime:e.viewTime/1e3,endTime:(e.viewTime+18e5)/1e3,type:e.types.indexOf(e.selectedType)-1,phone:t.name};o.getData("./api/content.action",t).then(function(t){e.records=t,e.show=!0},function(t){e.error=t})}}),u.on("click",function(t){if("series"===t.componentType&&"bar"===t.seriesType){var n=-1;a.map(function(e,a){e.name==t.name&&(n=a)});var t={startTime:e.viewTime/1e3,endTime:(e.viewTime+18e5)/1e3,type:n};o.getData("./api/content.action",t).then(function(t){e.records=t,e.show=!0},function(t){e.error=t})}}),d.on("click",function(t){if("series"===t.componentType&&"line"===t.seriesType)if("edge"===t.dataType);else{var a=new Date("2017-02-"+t.name.substring(0,2)+" "+t.name.substring(3,8)+":00");e.viewTime=a.getTime()-18e5,e.show=!1,e.records=[];var t={startTime:(a.getTime()-18e5)/1e3,endTime:a.getTime()/1e3,type:e.types.indexOf(e.selectedType)-1};o.getData("./api/position.action",t).then(function(t){p.setData(t.maps),e.timeRange="当前时间："+i("date")(t.area.stime,"yyyy年M月d日")+i("date")(t.area.stime," HH:mm ")+"至"+i("date")(t.area.etime," HH:mm"),u.setOption({series:[{data:t.bars}]}),y.setOption({series:[{data:t.phone}]})},function(t){e.error=t})}}),e.start=function(){e.intervalEvent=n(function(){t.get("startTime")!=new Date(e.currentTime).valueOf()/1e3&&(t.set("startTime",new Date(e.currentTime).valueOf()/1e3),e.areas=[],d.setOption({xAxis:{data:e.areas.map(function(e){return i("date")(e.etime,"d日HH:mm")})},series:[{data:e.areas.map(function(e){return e.num})}]}));var a={startTime:parseInt(t.get("startTime")),endTime:parseInt(t.get("startTime"))+1800,type:e.types.indexOf(e.selectedType)-1};o.getData("./api/position.action",a).then(function(t){p.setData(t.maps),e.timeRange="当前时间："+i("date")(t.area.stime,"yyyy年M月d日")+i("date")(t.area.stime,"HH:mm")+"至"+i("date")(t.area.etime,"HH:mm"),u.setOption({series:[{data:t.bars}]}),y.setOption({series:[{data:t.phone}]}),e.areas.push(t.area),d.setOption({xAxis:{data:e.areas.map(function(e){return i("date")(e.etime,"d日HH:mm")})},series:[{data:e.areas.map(function(e){return e.num})}]})},function(t){e.error=t}),e.viewTime=parseInt(1e3*t.get("startTime")),e.show=!1,e.records=[],t.set("startTime",parseInt(t.get("startTime"))+1800),e.currentTime=i("date")(t.get("startTime")+"000","yyyy-MM-dd HH:mm:ss")},1e4)},e.flag="",e.stop=function(a){"Pause"==a?(n.cancel(e.intervalEvent),e.flag="Start"):(e.start(t.get("startTime")),e.flag="Pause",e.show=!1,e.records=[])}})}]),angular.module("chinavis").controller("analysisController",["$scope","colorMap","visService","$interval","$filter",function(e,t,a,o,n){e.months=[{name:"二月",url:"data/M2-30min.json"},{name:"三月",url:"data/M3-30min.json"},{name:"四月",url:"data/M4-30min.json"}],e.currentMonth="二月",a.getData(e.months[0].url,{}).then(function(t){e.data0=t},function(t){e.error=t}),e.show=function(t){a.getData(e.months[t].url,{}).then(function(a){e.currentMonth=a.name,0===t?(e.data0=a,e.data1=null,e.data2=null):1===t?(e.data0=null,e.data1=a,e.data2=null):2===t&&(e.data0=null,e.data1=null,e.data2=a)},function(t){e.error=t})}}]),angular.module("chinavis").directive("areaChart",["$filter","colorMap",function(e,t){return{restrict:"AE",scope:{data:"="},template:"<div></div>",link:function(a,o){var n=o.find("div")[0];n.style.height="249px",n.style.width="100%",echarts.init(n).setOption({title:{text:a.data.name,textStyle:{color:"#aaaaaa",fontSize:15},top:15,left:40},tooltip:{trigger:"axis",axisPointer:{type:"cross",lineStyle:{type:"dashed",width:1},label:{backgroundColor:"#6a7985"}},position:{right:10,top:10}},grid:{left:"1%",right:"2%",bottom:"1%",containLabel:!0},dataZoom:[{show:!1,realtime:!0,start:0,end:50},{type:"inside"}],color:t.map(function(e){return e.color}),legend:{top:15,data:t.map(function(e){var t={};return t.name=e.name,t.textStyle={color:e.color},t})},xAxis:{type:"category",boundaryGap:!1,axisLine:{onZero:!0,lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}},data:a.data.value.map(function(t){return e("date")(t.time,"M月d日H时mm分")})},yAxis:{type:"value",splitLine:{show:!1},splitArea:{show:!1},axisLine:{lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}}},series:[{name:t[0].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[0].color}},smooth:!0,smoothMonotone:"x",symbolSize:0,showSymbol:!1,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g0||0})},{name:t[1].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[1].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g1||0})},{name:t[2].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[2].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g1||0})},{name:t[3].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[3].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g3||0})},{name:t[4].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[4].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g4||0})},{name:t[5].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[5].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g5||0})},{name:t[6].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[6].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g6||0})},{name:t[7].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[7].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g7||0})},{name:t[8].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[8].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g8||0})},{name:t[9].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[9].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g9||0})},{name:t[10].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[10].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g10||0})},{name:t[11].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[11].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g11||0})},{name:t[12].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:t[12].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(e){return e.g12||0})}]})}}}]),angular.module("chinavis").directive("barChart",["$filter","colorMap",function(e,t){return{restrict:"AE",scope:{data:"=",type:"="},template:"<div></div>",link:function(a,o){var n=["各时间段伪基站活跃情况","各类短信数量对比"],i=o.find("div")[0];i.style.height="230px",i.style.width="100%",echarts.init(i).setOption({title:{text:n[a.type],textStyle:{color:"#aaaaaa",fontSize:15},top:15,left:40},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"1%",right:"2%",bottom:"1%",containLabel:!0},xAxis:[{type:"category",axisLine:{onZero:!0,lineStyle:{color:"#aaaaaa"}},axisLabel:{show:!0,interval:0,textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}},data:a.data.map(function(o){return 0===a.type?e("date")(o.time,"HH:mm"):1===a.type?t[o.type].name:void 0})}],yAxis:[{type:"value",splitLine:{show:!1},splitArea:{show:!1},axisLine:{lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}}}],series:[{name:"总量",type:"bar",barWidth:"60%",itemStyle:{normal:{color:function(e){return 0===a.type?"#3398DB":1===a.type?t[e.dataIndex].color:void 0}}},data:a.data.map(function(e){return e.num})}]})}}}]),angular.module("chinavis").directive("pieChart",["$filter","colorMap",function(e,t){return{restrict:"AE",scope:{data:"="},template:"<div></div>",link:function(e,a){var o=[];e.data.second.map(function(e){var a={};a.name=t[e.type].name,a.value=e.num,a.itemStyle={normal:{color:t[e.type].color}},o.push(a)});var n=a.find("div")[0];n.style.height="490px",n.style.width="100%",echarts.init(n).setOption({title:{text:"各类短信所占比例",x:"center",bottom:30,textStyle:{color:"#aaaaaa",fontSize:15}},grid:{left:"2%",right:"2%",top:"2%",containLabel:!0},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:e.data.first},{name:"访问来源",type:"pie",radius:["40%","55%"],data:o}]})}}}]);
//# sourceMappingURL=app.min.js.map
