angular.module("chinavis",["ngAnimate","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("situation",{url:"/",templateUrl:"./Situation/situation.html",controller:"situationController"}).state("analysis",{url:"/analysis",templateUrl:"./Analysis/analysis.html",controller:"analysisController"}),e.otherwise("/")}]),angular.module("chinavis").service("visService",["$http","$q",function(t,e){return{getData:function(a,n){var o=e.defer();return t({method:"GET",url:a,params:n}).then(function(t){t.status=!0,o.resolve(t.data)},function(t){t.status=!1,o.reject(t)}),o.promise}}}]),angular.module("chinavis").constant("colorMap",[{name:"上门服务",color:"#17becf"},{name:"代开发票",color:"#1f77b4"},{name:"赌博麻将",color:"#ff7f0e"},{name:"办证刻章",color:"#2ca02c"},{name:"银行诈骗",color:"#d62728"},{name:"苹果诈骗",color:"#9467bd"},{name:"房地产广告",color:"#8c564b"},{name:"贷款服务",color:"#e377c2"},{name:"各类广告",color:"#bcbd22"},{name:"招聘信息",color:"#17becf"},{name:"诽谤谣言",color:"#5878cf"},{name:"中国移动",color:"#74b0a1"},{name:"收驾驶证",color:"#b09355"}]),angular.module("chinavis").factory("localStorage",["$window",function(t){return{set:function(e,a){t.localStorage[e]=a},get:function(e){return t.localStorage[e]||""},setObject:function(e,a){t.localStorage[e]=JSON.stringify(a)},getObject:function(e){return JSON.parse(t.localStorage[e]||"{}")}}}]),angular.module("chinavis").factory("getViewport",function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}),angular.module("chinavis").controller("situationController",["$scope","localStorage","getViewport","colorMap","visService","$interval","$filter",function(t,e,a,n,o,i,r){t.colorMap=n,t.currentTime="2017-02-24 10:00:00",t.viewTime=new Date(t.currentTime).valueOf()-18e5,e.set("startTime",new Date(t.currentTime).valueOf()/1e3),t.timeRange="",t.show=!1,t.close=function(){t.show=!1},t.records=[];var l=new AMap.Map("container",{mapStyle:"amap://styles/grey",zoom:11,center:[116.403909,39.915212]});l.setFeatures(["road","bg"]),AMapUI.load(["ui/misc/PointSimplifier","lib/utils","lib/$"],function(c,s,m){function u(t,e){u.__super__.constructor.apply(this,arguments)}if(!c.supportCanvas)return void alert("当前环境不支持 Canvas！");s.inherit(u,c.Render.Canvas),s.extend(u.prototype,{renderNormalPoints:function(t,e,a){u.__super__.renderNormalPoints.call(this,t,null,a);for(var n=this.getOption("pointStyle"),o=this.getOption("getPointsGroupKey"),i=this.getOption("pointStyleGroup"),r=this.getPointSimplifierInstance(),l={},c=0,m=e.length;c<m;c++){var d=e[c],p=d.idx,y=r.getDataItemByIndex(p),f=o.call(this,y,p);l[f]||(l[f]=[]),l[f].push(e[c])}for(var h in l){var g=s.extend({},n,i[h]);this.drawPointsWithStyleOptions(l[h],g)}}});var d=new c({map:l,getPosition:function(t){return t?[parseFloat(t.lng),parseFloat(t.lat)]:null},getHoverTitle:function(t){return t.content},autoSetFitView:!1,renderConstructor:u,renderOptions:{pointStyle:{width:5,height:5,fillStyle:"#d939bd"},hoverTitleStyle:{position:"top"},getPointsGroupKey:function(t){return"g"+t.type},pointStyleGroup:{g0:{fillStyle:n[0].color},g1:{fillStyle:n[1].color},g2:{fillStyle:n[2].color},g3:{fillStyle:n[3].color},g4:{fillStyle:n[4].color},g5:{fillStyle:n[5].color},g6:{fillStyle:n[6].color},g7:{fillStyle:n[7].color},g8:{fillStyle:n[8].color},g9:{fillStyle:n[9].color},g10:{fillStyle:n[10].color},g11:{fillStyle:n[11].color},g12:{fillStyle:n[12].color}}}});d.on("pointClick",function(t,e){});var p,y,f=a.width,h=97,g=d3.select("#area-stack").append("svg").attr("width",f).attr("height",h),v=0;o.getData("data/First-day.json",{}).then(function(e){t.timeRange="当前时间："+r("date")(e.areas[e.areas.length-1].stime,"yyyy年M月d日")+r("date")(e.areas[e.areas.length-1].stime," HH:mm ")+"至"+r("date")(e.areas[e.areas.length-1].etime," HH:mm"),d.setData(e.maps),t.areas=e.areas,t.showTooltip=function(t,e,a){d3.select("#tooltip").style("left",t+"px").style("top",e+"px").select("#value").text(a),d3.select("#tooltip").classed("hidden",!1)},t.hideTooltip=function(){d3.select("#tooltip").classed("hidden",!0)},p=d3.scale.ordinal().domain(d3.range(e.areas.length)).rangeRoundBands([0,f],.05),t.areas.map(function(t){t.num>v&&(v=t.num)}),y=d3.scale.linear().domain([0,v]).range([1,h]),g.selectAll("rect").data(t.areas).enter().append("rect").attr("x",function(t,e){return p(e)}).attr("y",function(t){return h-y(t.num)}).attr("width",p.rangeBand()).attr("height",function(t){return y(t.num)}).attr("fill",function(t,e){return 47===e?"rgba(255,255,255,0.9)":"rgba(255,255,255,0.5)"}).attr("cursor","pointer").on("mouseover",function(e){var n=d3.select(this).attr("x")-35;n<0?n=20:n+100>a.width&&(n=parseFloat(a.width-130));var o=d3.select(this).attr("y")-30;t.showTooltip(n,o,r("date")(e.stime,"M月d日HH:mm")+"-"+r("date")(e.etime,"HH:mm")),d3.select(this).transition().duration(100).attr("y",function(t){return h-y(t.num)-5})}).on("mouseout",function(){t.hideTooltip(),d3.select(this).transition().duration(100).attr("y",function(t){return h-y(t.num)})}).on("click",function(e){g.selectAll("rect").transition().duration(100).attr("fill","rgba(255,255,255,0.5)"),d3.select(this).transition().duration(100).attr("fill","rgba(255,255,255,0.9)"),t.showPoint(e.stime,e.etime)}),g.selectAll("text").data(t.areas).enter().append("text").text(function(t){return t.num>1e3?t.num:""}).attr("text-anchor","middle").attr("x",function(t,e){return p(e)+p.rangeBand()/2}).attr("y",function(t){return h-y(t.num)+10}).attr("font-size","10px").attr("fill","#0a141b").attr("pointer-events","none")},function(t){console.log(t)}),t.showContent=function(e){var a=-1;n.map(function(t,n){t.name===e&&(a=n)});var i={startTime:t.viewTime/1e3,endTime:(t.viewTime+18e5)/1e3,type:a};o.getData("./api/content",i).then(function(e){t.records=e,t.show=!0},function(t){console.log(t)})},t.showPoint=function(e,a){t.viewTime=e,t.show=!1,t.records=[];var n={startTime:e/1e3,endTime:a/1e3,type:-1};o.getData("./api/position",n).then(function(e){d.setData(e.maps),t.timeRange="当前时间："+r("date")(e.area.stime,"yyyy年M月d日")+r("date")(e.area.stime," HH:mm ")+"至"+r("date")(e.area.etime," HH:mm")},function(t){console.log(t)})},t.start=function(){t.intervalEvent=i(function(){var a={startTime:parseInt(e.get("startTime")),endTime:parseInt(e.get("startTime"))+1800,type:-1};o.getData("./api/position",a).then(function(e){d.setData(e.maps),t.timeRange="当前时间："+r("date")(e.area.stime,"yyyy年M月d日")+r("date")(e.area.stime,"HH:mm")+"至"+r("date")(e.area.etime,"HH:mm"),t.areas.push(e.area),t.areas.shift(),v=0,t.areas.map(function(t){t.num>v&&(v=t.num)}),y=d3.scale.linear().domain([0,v]).range([1,h]),g.selectAll("rect").data(t.areas).transition().duration(500).attr("y",function(t){return h-y(t.num)}).attr("height",function(t){return y(t.num)}).attr("fill",function(t,e){return 47===e?"rgba(255,255,255,0.9)":"rgba(255,255,255,0.5)"}),g.selectAll("title").data(t.areas).transition().duration(500).text(function(t){return r("date")(t.stime,"M月d日HH:mm")+"-"+r("date")(t.etime,"HH:mm")}),g.selectAll("text").data(t.areas).transition().duration(500).text(function(t){return t.num>1e3?t.num:""}).attr("y",function(t){return h-y(t.num)+10})},function(t){console.log(t)}),t.viewTime=parseInt(1e3*e.get("startTime")),t.show=!1,t.records=[],e.set("startTime",parseInt(e.get("startTime"))+1800),t.currentTime=r("date")(e.get("startTime")+"000","yyyy-MM-dd HH:mm:ss")},8e3)},t.flag="开始",t.stop=function(a){"暂停"===a?(i.cancel(t.intervalEvent),t.flag="开始"):(t.start(e.get("startTime")),t.flag="暂停",t.show=!1,t.records=[])}})}]),angular.module("chinavis").controller("analysisController",["$scope","colorMap","visService","$interval","$filter",function(t,e,a,n,o){t.months=[{name:"二月",url:"data/M2-30min.json"},{name:"三月",url:"data/M3-30min.json"},{name:"四月",url:"data/M4-30min.json"}],t.currentMonth="二月",a.getData(t.months[0].url,{}).then(function(e){t.data0=e},function(e){t.error=e}),t.show=function(e){a.getData(t.months[e].url,{}).then(function(a){t.currentMonth=a.name,0===e?(t.data0=a,t.data1=null,t.data2=null):1===e?(t.data0=null,t.data1=a,t.data2=null):2===e&&(t.data0=null,t.data1=null,t.data2=a)},function(e){t.error=e})}}]),angular.module("chinavis").directive("areaChart",["$filter","colorMap",function(t,e){return{restrict:"AE",scope:{data:"="},template:"<div></div>",link:function(a,n){var o=n.find("div")[0];o.style.height="249px",o.style.width="100%",echarts.init(o).setOption({title:{text:a.data.name,textStyle:{color:"#aaaaaa",fontSize:15},top:15,left:40},tooltip:{trigger:"axis",axisPointer:{type:"cross",lineStyle:{type:"dashed",width:1},label:{backgroundColor:"#6a7985"}},position:{right:10,top:10}},grid:{left:"1%",right:"2%",bottom:"1%",containLabel:!0},dataZoom:[{show:!1,realtime:!0,start:0,end:50},{type:"inside"}],color:e.map(function(t){return t.color}),legend:{top:15,data:e.map(function(t){var e={};return e.name=t.name,e.textStyle={color:t.color},e})},xAxis:{type:"category",boundaryGap:!1,axisLine:{onZero:!0,lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}},data:a.data.value.map(function(e){return t("date")(e.time,"M月d日H时mm分")})},yAxis:{type:"value",splitLine:{show:!1},splitArea:{show:!1},axisLine:{lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}}},series:[{name:e[0].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[0].color}},smooth:!0,smoothMonotone:"x",symbolSize:0,showSymbol:!1,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g0||0})},{name:e[1].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[1].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g1||0})},{name:e[2].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[2].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g1||0})},{name:e[3].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[3].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g3||0})},{name:e[4].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[4].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g4||0})},{name:e[5].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[5].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g5||0})},{name:e[6].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[6].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g6||0})},{name:e[7].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[7].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g7||0})},{name:e[8].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[8].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g8||0})},{name:e[9].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[9].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g9||0})},{name:e[10].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[10].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g10||0})},{name:e[11].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[11].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g11||0})},{name:e[12].name,type:"line",stack:"总量",lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:e[12].color}},symbolSize:3,hoverAnimation:!1,data:a.data.value.map(function(t){return t.g12||0})}]})}}}]),angular.module("chinavis").directive("barChart",["$filter","colorMap",function(t,e){return{restrict:"AE",scope:{data:"=",type:"="},template:"<div></div>",link:function(a,n){var o=["各时间段伪基站活跃情况","各类短信数量对比"],i=n.find("div")[0];i.style.height="230px",i.style.width="100%",echarts.init(i).setOption({title:{text:o[a.type],textStyle:{color:"#aaaaaa",fontSize:15},top:15,left:40},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"1%",right:"2%",bottom:"1%",containLabel:!0},xAxis:[{type:"category",axisLine:{onZero:!0,lineStyle:{color:"#aaaaaa"}},axisLabel:{show:!0,interval:0,textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}},data:a.data.map(function(n){return 0===a.type?t("date")(n.time,"HH:mm"):1===a.type?e[n.type].name:void 0})}],yAxis:[{type:"value",splitLine:{show:!1},splitArea:{show:!1},axisLine:{lineStyle:{color:"#aaaaaa"}},axisLabel:{textStyle:{color:"#aaaaaa"}},axisTick:{lineStyle:{color:"#aaaaaa"}}}],series:[{name:"总量",type:"bar",barWidth:"60%",itemStyle:{normal:{color:function(t){return 0===a.type?"#3398DB":1===a.type?e[t.dataIndex].color:void 0}}},data:a.data.map(function(t){return t.num})}]})}}}]),angular.module("chinavis").directive("pieChart",["$filter","colorMap",function(t,e){return{restrict:"AE",scope:{data:"="},template:"<div></div>",link:function(t,a){var n=[];t.data.second.map(function(t){var a={};a.name=e[t.type].name,a.value=t.num,a.itemStyle={normal:{color:e[t.type].color}},n.push(a)});var o=a.find("div")[0];o.style.height="490px",o.style.width="100%",echarts.init(o).setOption({title:{text:"各类短信所占比例",x:"center",bottom:30,textStyle:{color:"#aaaaaa",fontSize:15}},grid:{left:"2%",right:"2%",top:"2%",containLabel:!0},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:t.data.first},{name:"访问来源",type:"pie",radius:["40%","55%"],data:n}]})}}}]);
//# sourceMappingURL=app.min.js.map
